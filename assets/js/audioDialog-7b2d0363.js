import{g as F,a as L,b as z}from"./file-a5f5b941.js";import{a as M}from"./axios-aba6f0e0.js";import{a as N}from"./element-plus-08547807.js";import{k as U,e as y,$ as T,ah as r,o as g,P as k,Q as i,a as t,W as f,U as R,c as E,bb as P,b9 as j}from"./@vue-d9027515.js";import{_ as O}from"./plugin-vueexport-helper-c27b6911.js";import"./lodash-es-36eb724a.js";import"./@vueuse-2d9216d7.js";import"./@element-plus-6327e551.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-6aac7dfa.js";import"./@intlify-9e8a497c.js";import"./source-map-7d7e1c08.js";import"./async-validator-dee29e8b.js";import"./memoize-one-297ddbcb.js";import"./escape-html-1d60d822.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-682dc3ac.js";const Q=l=>(P("data-v-e6421832"),l=l(),j(),l),W={class:"icon"},$={class:"circle"},q={class:"circle-in"},G=Q(()=>t("span",null,"正在聆听...",-1)),H={key:1},J=["src"],K={class:"dialog-footer"},X=U({name:"audioDialog"}),Y=U({...X,emits:["sendAudio"],setup(l,{expose:w,emit:C}){const a=y(null),d=y([]),e=T({dialogVisible:!1,isRecording:!1,audioTime:0,stream:null,audioBlob:null,audioUrl:""}),V=async()=>{e.isRecording=!0;try{e.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),a.value=new MediaRecorder(e.stream),a.value.ondataavailable=o=>{d.value.push(o.data)},a.value.onstop=async()=>{e.audioBlob=new Blob(d.value,{type:"audio/mpeg"}),e.audioUrl=URL.createObjectURL(e.audioBlob)},a.value.start()}catch(o){e.isRecording=!1,N.error("录音失败："+o)}},x=()=>{a.value&&(a.value.stop(),e.isRecording=!1)},B=async o=>{const u="https://akram8.github.io/oginix-vite-demo/"+"/upload";let n=[];const s=[],c=new FormData;c.append("file",o,"audio-"+Date.now()+".mp3");const m=M.post(u,c,{}).then(A=>{const _=localStorage.getItem("name")+"的发言"+Date.now()+".mp3";n.push({id:"",name:_,type:F(_),typeColor:L(_),size:z(o.size),fileId:A.data.data})});return s.push(m),await Promise.all(s),n},D=()=>{e.dialogVisible=!0,V()},S=async()=>{const o=await B(e.audioBlob);C("sendAudio",o),v()},v=async()=>{b(),h(),e.dialogVisible=!1},I=o=>{o(),b(),h()},b=()=>{e.stream&&e.stream.getTracks().forEach(o=>{o.stop()})},h=()=>{e.audioBlob=null,e.audioUrl="",a.value=null,d.value=[]};return w({openAudioDialog:D}),(o,p)=>{const u=r("SvgIcon"),n=r("el-tooltip"),s=r("el-button"),c=r("el-dialog");return g(),k(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":p[0]||(p[0]=m=>e.dialogVisible=m),title:"语音发送","close-on-click-modal":!1,"before-close":I,width:"420px"},{footer:i(()=>[t("span",K,[f(s,{onClick:v},{default:i(()=>[R("取消")]),_:1}),f(s,{type:"primary",disabled:e.isRecording,onClick:S},{default:i(()=>[R("发送")]),_:1},8,["disabled"])])]),default:i(()=>[t("div",null,[e.isRecording?(g(),k(n,{key:0,content:"点击结束聆听",effect:"light"},{default:i(()=>[t("div",{class:"recording",onClick:x},[t("div",W,[t("div",$,[t("div",q,[f(u,{name:"ele-Microphone",size:20})])])]),G])]),_:1})):(g(),E("div",H,[t("audio",{style:{width:"100%"},src:e.audioUrl,controls:""},null,8,J)]))])]),_:1},8,["modelValue"])}}});const be=O(Y,[["__scopeId","data-v-e6421832"]]);export{be as default};
